{
  "kind": "build_request",
  "title": "Fix APK deployment so /assets/primepost.apk serves a valid binary",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Ensure the deployed site serves a real Android APK binary at the exact path `/assets/primepost.apk` (not an HTML fallback), and serves the metadata JSON at `/assets/primepost.apk.meta.json`. The deployed APK must be at least 1 MB and start with the ZIP/APK `PK` header bytes.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Deploy the apk please"
        ]
      },
      "acceptanceCriteria": [
        "Visiting `/assets/primepost.apk` returns a binary file download (not an HTML document).",
        "A HEAD request to `/assets/primepost.apk` returns a non-HTML Content-Type and a Content-Length >= 1,048,576 bytes.",
        "Fetching the first two bytes of `/assets/primepost.apk` yields `0x50 0x4B` (\"PK\").",
        "`/assets/primepost.apk.meta.json` is accessible and contains a numeric `size` matching the deployed APK size."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Add a pre-deploy staging step that guarantees `frontend/public/assets/primepost.apk` and `frontend/public/assets/primepost.apk.meta.json` exist and are valid before deployment, using the existing script `frontend/scripts/stage-android-apk-assets.sh` (or the platform-equivalent command runner). Fail the build/deploy if the staging script fails validation.",
      "target": "unknown",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Deploy the apk please"
        ]
      },
      "acceptanceCriteria": [
        "The deployment pipeline runs the staging script before deploying the frontend assets.",
        "If the APK is missing, < 1 MB, or does not start with `PK`, the deployment stops with a clear error message.",
        "After a successful deployment, the APK download page no longer reports `Content-Type: text/html` for the deployed APK."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Configure static asset serving so `.apk` files are not rewritten to the SPA entry HTML and are served with an APK-appropriate Content-Type (e.g., `application/vnd.android.package-archive`) at `/assets/primepost.apk`.",
      "target": "unknown",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Deploy the apk please"
        ]
      },
      "acceptanceCriteria": [
        "Requesting `/assets/primepost.apk` does not return the app HTML shell under any routing mode (direct navigation, refresh, or deep link).",
        "Response headers for `/assets/primepost.apk` indicate an APK/binary Content-Type rather than `text/html` or `text/plain`."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor (no additional backend services).",
    "Do not edit any files under `frontend/src/components/ui` or other immutable paths listed in SYSTEM_CONTEXT."
  ],
  "nonGoals": [
    "Publishing a signed Play Store release (AAB) or handling Play Store submission.",
    "Adding new application features unrelated to APK build/hosting."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}